<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Admin - GaoShala Donations</title>
  <style>body{font-family:Inter,Arial;margin:20px}table{width:100%;border-collapse:collapse}th,td{border:1px solid #ddd;padding:8px}th{background:#f4f4f4}</style>
</head>
<body>
  <h1>Donors</h1>
  <p><button id="refresh">Refresh</button> <a id="exportLink" href="/admin/export">Export CSV</a></p>
  <table id="donorsTable">
    <thead><tr><th>Name</th><th>Email</th><th>Amount</th><th>Campaign</th><th>Date</th></tr></thead>
    <tbody></tbody>
  </table>

  <script>
    async function load() {
      const res = await fetch('/admin/donors');
      if (res.status === 401) {
        document.body.innerHTML = '<h2>Authentication required</h2><p>Please sign-in using the browser basic auth prompt.</p>';
        return;
      }
      const list = await res.json();
      const tbody = document.querySelector('#donorsTable tbody');
      tbody.innerHTML = list.map(d => `<tr><td>${d.name}</td><td>${d.email || ''}</td><td>${d.amount}</td><td>${d.campaign || ''}</td><td>${d.date}</td></tr>`).join('');
    }
    document.getElementById('refresh').addEventListener('click', load);
    load();
  </script>
</body>
</html>